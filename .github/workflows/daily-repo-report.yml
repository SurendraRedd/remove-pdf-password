name: Daily Repo Status Report

on:
  schedule:
    - cron: '0 7 * * *'     # 7:00 UTC â†’ change if you want different time
  workflow_dispatch:        # allows manual trigger from Actions tab

permissions:
  issues: write
  contents: read

jobs:
  report:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Generate daily report
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          yesterday=$(date -d "yesterday" '+%Y-%m-%d')

          {
            echo "# Daily Repo Status - $(date '+%Y-%m-%d')"
            echo ""
            echo "## Recent Activity (since $yesterday)"
            echo '```'
            gh issue list --state all --search "updated:>$yesterday" --limit 20 --json number,title,url,state || echo "No issues updated"
            echo '```'
            echo '```'
            gh pr list   --state all --search "updated:>$yesterday" --limit 20 --json number,title,url,state || echo "No pull requests updated"
            echo '```'

            echo "## New Commits"
            git log --since="$yesterday" --pretty=format:"* %h %s (%an)" || echo "No new commits today"

            # You can easily add more sections later, examples:
            # echo "## Releases"
            # gh release list --limit 5

          } > report.md

      - name: Create new daily issue
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          TODAY=$(date '+%Y-%m-%d')

          gh issue create \
            --title "Daily Repo Status - $TODAY" \
            --body-file report.md \
            --label "daily-report" \
            --label "automation" \
            --assignee ${{ github.actor }}          # assigns to person who created workflow (usually you)
